{{#in apiType values="REST"}}

<head>
  <link rel="stylesheet" href="https://unpkg.com/@stoplight/elements/styles.min.css">
  <script src="https://unpkg.com/@stoplight/elements/web-components.min.js"></script>
</head>
<main>
  <div class="p-4">
    <elements-api apiDescriptionDocument='{{swagger}}' router="hash" layout="sidebar" />
  </div>
  <style>
    .sl-py-16 {
      max-width: 900px !important;
    }

    @media (max-width: 1700px) {
      .sl-py-16 {
        max-width: 800px !important;
      }
    }

    @media (max-width: 1600px) {
      .sl-py-16 {
        max-width: 700px !important;
      }
    }

    @media (max-width: 1500px) {
      .sl-py-16 {
        max-width: 600px !important;
      }
    }

    .sl-px-24 {
      padding-right: 0px;
      padding-left: 30px;
    }

    .sl-border-t {
      display: none;
    }
  </style>
</main>
{{/in}}
{{#if (eq apiType "WS")}}

<head>
  <link rel="stylesheet" href="/technical-styles/async-tryout.css">
</head>
<main>
  <div id="root" style="height: 100vh;"></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@asyncapi/react-component@latest/browser/standalone/index.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/wso2/api-developer-portal-core@refs/heads/main/libs/async-api-viewer/dist/websocket-viewer.umd.js"></script>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/wso2/api-developer-portal-core@refs/heads/main/libs/async-api-viewer/dist/async-api-viewer.css"
  />
  <script>
    const isWebSocketTryout = {{#if isWebSocketTryout}}{{isWebSocketTryout}}{{else}}false{{/if}};
    if (isWebSocketTryout) {
      document.addEventListener('DOMContentLoaded', function () {
        const swaggerData = {{{ asyncapi }}};
        let serverUrl = swaggerData.servers && swaggerData.servers.production ? swaggerData.servers.production.url : '';
        const rootElement = document.getElementById('root');
        rootElement.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: montserrat;">Loading AsyncAPI Viewer...</div>';
        ReactDOM.render(React.createElement(WebSocketViewer.default, {
            apiEndpoint: serverUrl,
            token: '<your-token-here>',
            asyncapi: swaggerData,
            isDevportal: true
        }), rootElement);
      });
    } else {
      const config = { "show": { "sidebar": false }, "sidebar": { "showOperations": "byDefault" } };
      AsyncApiStandalone.hydrate({
        schema: {{{ asyncapi }}},
        config
      }, document.getElementById('root'));
    }
  </script>
</main>

{{else if (eq apiType "GRAPHQL")}}

{{#if isGraphQLTryout}}
<head>
  <link rel="stylesheet" href="https://unpkg.com/graphiql@3/graphiql.min.css">
  <link rel="stylesheet" href="https://unpkg.com/@graphiql/plugin-explorer@3/dist/style.css">
  <link rel="stylesheet" href="/technical-styles/graphql-tryout.css">
</head>
<main>
  <div class="graphql-tryout-container">
    <div class="graphql-controls" id="graphql-controls">
      <div class="graphql-control">
        <label for="graphql-endpoint-input">Endpoint URL</label>
        <input id="graphql-endpoint-input" type="text" spellcheck="false" />
        <div class="control-hint" id="graphql-endpoint-status"></div>
      </div>
      <div class="graphql-control">
        <label for="graphql-token-input">Authorization Header</label>
        <input id="graphql-token-input" type="text" placeholder="Bearer &lt;token&gt;" spellcheck="false" />
        <div class="control-hint" id="graphql-token-status"></div>
      </div>
    </div>
    <div id="root" style="flex: 1; min-height: 0;"></div>
  </div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/graphiql@3/graphiql.min.js"></script>
  <script src="https://unpkg.com/@graphiql/plugin-explorer@3/dist/index.umd.js"></script>
  <script id="graphql-schema-introspection-json" type="application/json">{{{graphqlSchemaAsIntrospectionJSON}}}</script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const apiEndpoint = '{{ apiMetadata.endPoints.productionURL }}';
      const rootElement = document.getElementById('root');
      rootElement.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: montserrat;">Loading GraphiQL...</div>';
      
      const endpointInput = document.getElementById('graphql-endpoint-input');
      const endpointStatus = document.getElementById('graphql-endpoint-status');
      const tokenInput = document.getElementById('graphql-token-input');
      const tokenStatus = document.getElementById('graphql-token-status');
      let currentEndpoint = apiEndpoint || '';
      let authToken = '';

      const updateEndpointStatus = () => {
        if (!endpointStatus) {
          return;
        }
        if (!currentEndpoint) {
          endpointStatus.textContent = 'Endpoint is required';
          endpointStatus.style.color = '#d1242f';
          return;
        }
        endpointStatus.textContent = currentEndpoint;
        endpointStatus.style.color = '#57606a';
      };

      const updateTokenStatus = () => {
        if (!tokenStatus) {
          return;
        }
        tokenStatus.textContent = authToken
          ? 'Authorization header will be sent with each request'
          : 'Header not set';
        tokenStatus.style.color = authToken ? '#1f883d' : '#57606a';
      };

      if (endpointInput) {
        endpointInput.value = apiEndpoint || '';
        endpointInput.addEventListener('input', function (event) {
          const value = (event.target.value || '').trim();
          currentEndpoint = value || apiEndpoint || '';
          updateEndpointStatus();
        });
      }

      if (tokenInput) {
        tokenInput.addEventListener('input', function (event) {
          authToken = (event.target.value || '').trim();
          updateTokenStatus();
        });
      }

      updateEndpointStatus();
      updateTokenStatus();

      const schemaScript = document.getElementById('graphql-schema-introspection-json');
      let schemaIntrospectionJSON = null;      
      try {
        if (!schemaScript || !schemaScript.textContent || schemaScript.textContent.trim() === '' || schemaScript.textContent === 'null') {
          rootElement.innerHTML = '<div style="padding: 20px; color: red;">Error: No schema definition found in database. Please ensure the GraphQL schema is properly saved.</div>';
          return;
        }
        schemaIntrospectionJSON = JSON.parse(schemaScript.textContent);
      } catch (error) {
        console.error('Error parsing schema introspection JSON:', error);
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = 'padding: 20px; color: red;';
        errorDiv.textContent = 'Error parsing schema: ' + (error && error.message ? error.message : '');
        rootElement.innerHTML = '';
        rootElement.appendChild(errorDiv);
        return;
      }
      
      const fetcher = async (graphQLParams) => {
        try {
          if (!currentEndpoint) {
            throw new Error('Endpoint URL is required');
          }
          
          const headers = {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
          };

          if (authToken) {
            headers['Authorization'] = authToken;
          }

          const response = await fetch(currentEndpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify(graphQLParams),
          });
          
          if (!response.ok) {
            const errorText = await response.text();
            console.error('GraphQL response error:', response.status, errorText);
            return { 
              errors: [{ 
                message: `HTTP ${response.status}: ${errorText || response.statusText}` 
              }] 
            };
          }
          
          const result = await response.json();
          return result;
        } catch (error) {
          console.error('GraphQL request error:', error);
          return { 
            errors: [{ 
              message: `Network error: ${error.message}. Please check if the endpoint URL is correct and accessible.` 
            }] 
          };
        }
      };
      
      let plugins = [];
      if (typeof GraphiQLPluginExplorer !== 'undefined' && GraphiQLPluginExplorer.explorerPlugin) {
        try {
          const explorerPlugin = GraphiQLPluginExplorer.explorerPlugin();
          plugins.push(explorerPlugin);
        } catch (error) {
          console.warn('Failed to initialize Explorer plugin:', error);
        }
      } else {
        console.warn('Explorer plugin not available');
      }
      
      ReactDOM.render(React.createElement(GraphiQL, {
        fetcher: fetcher,
        schema: schemaIntrospectionJSON,
        plugins: plugins.length > 0 ? plugins : undefined,
        defaultEditorToolsVisibility: true,
        forcedTheme: "light"
      }), rootElement);
    });
  </script>
</main>
{{else}}
<head>
</head>
<main>
  <div id="root" style="height: 100vh;"></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/wso2/api-developer-portal-core@refs/heads/main/libs/graphql-schema-viewer/dist/graphql-schema-viewer.umd.js"></script>
  <script id="graphql-schema-data" type="application/json">{{{graphql}}}</script>
  <script id="graphql-api-metadata" type="application/json">{{{apiMetadataJSON}}}</script>
  <script>
      document.addEventListener('DOMContentLoaded', function () {
        let schemaData = '';
        let apiMetadata = {};
        
        try {
          const schemaScript = document.getElementById('graphql-schema-data');
          if (schemaScript && schemaScript.textContent) {
            schemaData = JSON.parse(schemaScript.textContent);
          }
          
          const metadataScript = document.getElementById('graphql-api-metadata');
          if (metadataScript && metadataScript.textContent) {
            apiMetadata = JSON.parse(metadataScript.textContent);
          }
        } catch (error) {
          console.error('Error parsing GraphQL schema or metadata:', error);
          const rootElement = document.getElementById('root');
          const errorDiv = document.createElement('div');
          errorDiv.style.cssText = 'padding: 20px; color: #d1242f;';
          errorDiv.textContent = 'Error loading GraphQL schema. Please refresh the page.';
          rootElement.innerHTML = '';
          rootElement.appendChild(errorDiv);
          return;
        }
        
        const rootElement = document.getElementById('root');
        rootElement.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: montserrat;">Loading GraphQL Schema Viewer...</div>';
        ReactDOM.render(React.createElement(GraphQLSchemaViewer.default, {
          schema: schemaData,
          apiMetadata: apiMetadata
        }), rootElement);
      });
  </script>
</main>
{{/if}}

{{else if (eq apiType "MCP")}}

<head>
    <script>
        window.process = {env: {NODE_ENV: 'production'}};
    </script>
    <script src="https://unpkg.com/react@17.0.2/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/thisaltennakoon/mcp-inspector@main11/dist/mcp-inspector.umd.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<main>
    <div id="root" style="height: 100vh;"></div>
    <style>
        .mcp-MuiTypography-h3 {
            font-family: 'Montserrat', sans-serif;
        }
    </style>
    <script>
        // Wait for the DOM to be ready
        document.addEventListener('DOMContentLoaded', function () {
            // Extract URL from swagger JSON
            const swaggerData = {{{swagger}}};
            let serverUrl = swaggerData.servers && swaggerData.servers.length > 0 ? swaggerData.servers[0].url : '';

            // Add '/mcp' to the end of the URL if URL is available
            if (serverUrl) {
                serverUrl = serverUrl + '/mcp';
            }

            const rootElement = document.getElementById('root');

            // Show loading message first
            rootElement.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: montserrat;">Loading MCP Inspector...</div>';

            // Then render the actual component
            ReactDOM.render(React.createElement(MCPInspector.default, {
                url: serverUrl,
                tokenPlaceholder: 'Bearer <your-token-here>',
            }), rootElement);
        });
    </script>
</main>
{{/if}}
